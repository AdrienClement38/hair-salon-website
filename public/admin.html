<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - La Base Coiffure</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>

    <div id="setup-view" class="login-wrapper" style="display: none;">
        <div class="login-box">
            <h2 style="text-align: center;">Configuration Admin</h2>
            <p style="text-align: center; color: #666;">Créez votre compte administrateur</p>
            <form id="setup-form">
                <div class="form-group">
                    <label>Nouvel Utilisateur</label>
                    <input type="text" id="setup-username" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <div class="password-wrapper">
                        <input type="password" id="setup-password" required>
                        <button type="button" class="password-toggle" onclick="togglePassword(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn">Créer le compte</button>
            </form>
        </div>
    </div>

    <div id="login-view" class="login-wrapper">
        <div class="login-box">
            <h2 style="text-align: center;">Admin Panel</h2>
            <form id="login-form">
                <div class="form-group">
                    <label>Utilisateur</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" required>
                        <button type="button" class="password-toggle" onclick="togglePassword(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn">Se connecter</button>
                <p id="login-error" style="color: red; display: none;">Identifiants incorrects</p>
            </form>
        </div>
    </div>

    <div id="dashboard-view" class="dashboard">
        <header>
            <h1>Tableau de Bord</h1>
            <div style="display:flex; gap:10px; align-items:center;">
                <select id="admin-filter" onchange="loadAppointments()"
                    style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                    <option value="">Tous les RDV</option>
                </select>
                <button onclick="logout()" class="btn" style="width: auto;">Déconnexion</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('appointments')"
                id="tab-btn-appointments">Rendez-vous</button>
            <button class="tab-btn" onclick="switchTab('settings')" id="tab-btn-settings">Configuration</button>
            <button class="tab-btn" onclick="switchTab('content')" id="tab-btn-content">Contenu Site</button>
        </div>

        <!-- Appointments Tab -->
        <div id="tab-appointments" class="tab-content active">
            <div class="calendar-controls">
                <button class="btn" onclick="changeMonth(-1)" style="width:auto">&lt;</button>

                <div style="display: flex; gap: 10px;">
                    <select id="calendar-month-select" onchange="jumpToDate()" style="padding: 5px; font-size: 1rem;">
                        <option value="0">Janvier</option>
                        <option value="1">Février</option>
                        <option value="2">Mars</option>
                        <option value="3">Avril</option>
                        <option value="4">Mai</option>
                        <option value="5">Juin</option>
                        <option value="6">Juillet</option>
                        <option value="7">Août</option>
                        <option value="8">Septembre</option>
                        <option value="9">Octobre</option>
                        <option value="10">Novembre</option>
                        <option value="11">Décembre</option>
                    </select>
                    <select id="calendar-year-select" onchange="jumpToDate()" style="padding: 5px; font-size: 1rem;">
                        <!-- JS provides years -->
                    </select>
                </div>

                <button class="btn" onclick="changeMonth(1)" style="width:auto">&gt;</button>
            </div>

            <div class="calendar-grid">
                <!-- Headers -->
                <div class="calendar-day-header">Lun</div>
                <div class="calendar-day-header">Mar</div>
                <div class="calendar-day-header">Mer</div>
                <div class="calendar-day-header">Jeu</div>
                <div class="calendar-day-header">Ven</div>
                <div class="calendar-day-header">Sam</div>
                <div class="calendar-day-header">Dim</div>

                <!-- Days injected here -->
                <div id="calendar-days" style="display: contents;"></div>
            </div>

            <!-- Day Details Section (Inline) -->
            <div id="day-details-inline"
                style="display:none; margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                    <h3 id="details-date-label" style="margin:0;">Détails</h3>
                    <button onclick="closeDayDetails()" class="btn"
                        style="width:auto; padding:5px 10px; background:#ccc; font-size: 0.8rem;">Fermer</button>
                </div>
                <div id="day-appointments-list"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content">
            <div class="settings-form">

                <div class="settings-section">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 15px;">
                        <h3 style="margin:0; border:none; padding:0;">Horaires Hebdomadaires</h3>
                        <button class="btn" style="width:auto; padding:5px 10px; font-size:0.8rem;"
                            onclick="copyMondayToAll()">Copier Lundi partout</button>
                    </div>

                    <table id="schedule-table">
                        <thead>
                            <tr>
                                <th>Jour</th>
                                <th>Ouvert</th>
                                <th>Ouverture</th>
                                <th>Fermeture</th>
                            </tr>
                        </thead>
                        <tbody id="schedule-tbody">
                            <!-- Rows generated by JS -->
                        </tbody>
                    </table>
                    <button class="btn" onclick="saveSchedule()" style="margin-top: 15px; width: auto;">Enregistrer les
                        Horaires</button>
                </div>



                <div class="settings-section">
                    <h3>Congés Exceptionnels</h3>
                    <div class="form-group">
                        <label>Ajouter une période de congés</label>
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <div>
                                <label style="font-size: 0.9em;">Début</label>
                                <input type="date" id="holiday-start">
                            </div>
                            <div>
                                <label style="font-size: 0.9em;">Fin</label>
                                <input type="date" id="holiday-end">
                            </div>
                            <button class="btn" onclick="addHolidayRange()"
                                style="width: auto; padding: 10px 20px;">Ajouter</button>
                        </div>
                    </div>

                    <div id="holiday-list" style="margin-top: 20px;">
                        <!-- Ranges injected here -->
                    </div>
                    <button class="btn" onclick="saveHolidays()" style="margin-top: 15px; width: auto;">Enregistrer les
                        Congés</button>
                </div>

                <!-- Profile Section -->
                <div class="settings-section">
                    <h3>Mon Profil</h3>
                    <form id="profile-form">
                        <div class="form-group">
                            <label>Nom d'affichage</label>
                            <input type="text" id="profile-displayname" placeholder="Votre nom public">
                        </div>
                        <div class="form-group">
                            <label>Nouveau mot de passe (laisser vide pour ne pas changer)</label>
                            <div class="password-wrapper">
                                <input type="password" id="profile-new-pass" placeholder="Nouveau mot de passe">
                                <button type="button" class="password-toggle" onclick="togglePassword(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ancien mot de passe (requis pour valider)</label>
                            <div class="password-wrapper">
                                <input type="password" id="profile-old-pass" disabled placeholder="Mot de passe actuel">
                                <button type="button" class="password-toggle" onclick="togglePassword(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn" style="width:auto">Mettre à jour</button>
                    </form>
                </div>

                <!-- Team Section -->
                <div class="settings-section">
                    <h3>Gestion de l'Équipe</h3>
                    <p>Ajouter un nouveau coiffeur / administrateur.</p>
                    <form id="team-form">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <div class="form-group">
                                <label>Identifiant (Login)</label>
                                <input type="text" id="team-username" required>
                            </div>
                            <div class="form-group">
                                <label>Nom d'affichage (Client)</label>
                                <input type="text" id="team-displayname" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Mot de passe initial</label>
                            <div class="password-wrapper">
                                <input type="password" id="team-password" required>
                                <button type="button" class="password-toggle" onclick="togglePassword(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn" style="width:auto">Ajouter le membre</button>
                    </form>
                </div>

            </div>
        </div>

        <!-- Photos Tab -->
        <!-- Content Tab (Replaces Photos) -->
        <div id="tab-content" class="tab-content">
            <div class="settings-form">
                <h3>Contenu du Site</h3>
                <p>Personnalisez les éléments de la page d'accueil.</p>

                <!-- General Text -->
                <div class="settings-section">
                    <h4>Textes</h4>
                    <div class="form-group">
                        <label>Titre Principal (Section Accueil)</label>
                        <input type="text" id="content-title" placeholder="Ex: La Base Coiffure">
                    </div>
                    <div class="form-group">
                        <label>Sous-titre (Section Accueil)</label>
                        <input type="text" id="content-subtitle" placeholder="Ex: L'Art de la Coupe">
                    </div>
                    <div class="form-group">
                        <label>Texte "Notre Philosophie"</label>
                        <textarea id="content-philosophy" rows="4" style="width:100%; padding:8px;"
                            placeholder="Votre texte ici..."></textarea>
                    </div>
                    <button class="btn" onclick="saveTextSettings()" style="width:auto; margin-top:10px;">Enregistrer
                        les
                        Textes</button>
                </div>

                <!-- Images -->
                <div class="settings-section">
                    <h4>Images</h4>
                    <div class="form-group">
                        <label>Image d'Accueil</label>
                        <div class="admin-thumb-container">
                            <img id="thumb-hero" class="admin-thumb" src="" alt="Aperçu Hero">
                            <button class="btn" onclick="openPositioning('hero-bg')"
                                style="width:auto; font-size:0.8rem; background-color: var(--primary); color:black;">Positionner
                                l'image</button>
                        </div>
                        <form id="upload-hero" style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                            <input type="file" name="hero-bg" accept="image/*" required>
                            <button type="submit" class="btn btn-outline" style="width:auto; font-size:0.8rem;">Mettre à
                                jour le fichier</button>
                        </form>
                    </div>
                    <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
                    <div class="form-group">
                        <label>Image "Notre Philosophie"</label>
                        <div class="admin-thumb-container">
                            <img id="thumb-philosophy" class="admin-thumb" src="" alt="Aperçu Philo">
                            <button class="btn" onclick="openPositioning('philosophy-bg')"
                                style="width:auto; font-size:0.8rem; background-color: var(--primary); color:black;">Positionner
                                l'image</button>
                        </div>
                        <form id="upload-philosophy"
                            style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                            <input type="file" name="philosophy-bg" accept="image/*" required>
                            <button type="submit" class="btn btn-outline" style="width:auto; font-size:0.8rem;">Mettre à
                                jour le fichier</button>
                        </form>
                    </div>
                </div>

                <!-- ... existing code ... -->
                <!-- Prestations (Moved from Configuration) -->
                <div class="settings-section">
                    <h3>Prestations</h3>
                    <div id="services-list"></div>

                    <div style="margin-top: 20px; background: #fafafa; padding: 15px; border-radius: 4px;">
                        <h5>Ajouter une prestation</h5>
                        <div class="form-group">
                            <label>Nom</label>
                            <input type="text" id="new-service-name">
                        </div>
                        <div style="display:flex; gap:10px;">
                            <div class="form-group" style="flex:1">
                                <label>Prix</label>
                                <input type="number" id="new-service-price" step="0.5" min="0"
                                    onkeydown="return ['Backspace','Delete','ArrowLeft','ArrowRight','Tab'].includes(event.key) || (!isNaN(Number(event.key)) || event.key === '.' || event.key === ',')">
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>Icône</label>
                                <select id="new-service-icon" style="width:100%; padding:8px;">
                                    <option value="cut">Ciseaux</option>
                                    <option value="razor">Rasoir</option>
                                    <option value="barber">Barber Pole</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description (Info-bulle)</label>
                            <input type="text" id="new-service-desc">
                        </div>
                        <div style="display:flex; gap: 10px; margin-top: 15px;">
                            <button class="btn" id="btn-add-service" onclick="addService()" style="width:auto">Ajouter à
                                la liste</button>
                            <button class="btn btn-outline" id="btn-cancel-service" onclick="cancelEditService()"
                                style="width:auto; display: none;">Annuler</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h3>Modifier l'heure</h3>
            <p>Modification pour le RDV de <strong id="edit-client-name"></strong> le <span
                    id="edit-date-display"></span>.</p>
            <input type="hidden" id="edit-id">
            <div class="form-group">
                <label>Nouvelle Heure</label>
                <input type="time" id="edit-time" step="3600"> <!-- Step 1 hour -->
            </div>
            <button class="btn" onclick="saveEdit()">Enregistrer</button>
            <button class="btn" onclick="closeEdit()" style="background: #ccc; margin-top: 10px;">Annuler</button>
        </div>
    </div>

    <!-- Positioning Modal -->
    <div id="position-modal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div>
                    <h3 style="margin-top:0; color:var(--primary);">Positionner l'image</h3>
                    <p style="color:#ccc; margin-bottom:0;">Cliquez sur le point d'intérêt principal (visage, objet).
                    </p>
                </div>
                <button onclick="closePositionModal()"
                    style="background:none; border:none; color:#999; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>

            <div style="text-align:center; background:#111; padding:10px; border-radius:4px; margin-top:10px;">
                <div id="position-container">
                    <img id="position-image" src="">
                    <div id="position-marker"></div>
                </div>
            </div>

            <div class="position-footer">
                <div id="position-coords">X: 50% Y: 50%</div>
                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="savePosition()"
                        style="background:var(--primary); color:#000; font-weight:bold;">Valider la position</button>
                    <button class="btn btn-outline" onclick="closePositionModal()"
                        style="border-color:#666; color:#ccc;">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Socket.io removed -->
    <script type="module" src="js/admin/main.js"></script>
</body>

</html>